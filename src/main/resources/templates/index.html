
<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body id="body">
<nav class="navbar navbar-expand-lg bg-dark">
    <a class="navbar-brand text-light text font-weight-bold" th:text="${currentUser.getUsername()}"></a>
    <div class="text-light">with roles:</div>
    <div class="text-light m-1" th:text="${currentUser.getAuthorities()}"></div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
    <form action="/logout" method="post" class="ml-auto mt-2 mt-md-0">
        <button type="submit" class="mr-sm-2 my-2 my-sm-0">Logout</button>
    </form>
</nav>
<div style="height:100vh">
    <section class="row" style="height: 100vh">

        <div class="col-md-2" style="padding-right: 0px">
            <ul class="nav nav-pills flex-column" style="padding-top: 10px ; width: 100%">

                <li class="nav-item" style="height: 40px" sec:authorize="hasAuthority('ADMIN')">
                    <a href="/admin" class="nav-link active">Admin</a>

                </li>
                <li class="nav-item">
                    <a href="/user" class="nav-link">User</a>
                </li>

            </ul>
        </div>

        <div class="container mx-auto col bg-light" style="padding-left: 2em; padding-right: 5em">
            <h1 class="text " style="margin-top: 10px">Users information-page</h1>

                <ul class="nav nav-tabs" id="cards" style="padding-left: 0em; margin-bottom: 0em" role="tablist">
                    <li class="nav-item"><a id="home-tab" class="nav-link active" href="#users" >Users table</a> </li>
                    <li class="nav-item"> <a class="nav-link" href="#newUser">New User</a> </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="users">
                        <div class="card">
                            <div class="card-header font-weight-bold"> All Users </div>
                            <div class="card-body w-100" style="margin-top:20px" id="cardBody">
                                <div class="container w-100" style="margin-top:20px">
                                    <table class="table align-middle auto__table table-striped">
                                        <thead class="thead">
                                        <th class="text-center">Id</th>
                                        <th class="text-center">Email</th>
                                        <th class="text-center">Name</th>
                                        <th class="text-center">LastName</th>
                                        <th class="text-center">Age</th>
                                        <th class="text-center">Role</th>
                                        <th class="text-center">Edit</th>
                                        <th class="text-center">Delete</th>
                                        </thead>
                                        <tbody>
                                        <tr
                                                th:each="user : ${users}">
                                            <td th:text="${user.id}" class="text-center"></td>
                                            <td th:text="${user.username}" class="text-center"></td>
                                            <td th:text="${user.name}" class="text-center"></td>
                                            <td th:text="${user.lastName}" class="text-center"></td>
                                            <td th:text="${user.age}" class="text-center"></td>
                                            <td th:text="${user.roles}" class="text-center"></td>
                                            <td>
<!--                                                <a class="btn btn-primary" th:href="@{/admin/edit(id=${user.getId()})}">Edit</a>-->
                                                <!-- Кнопка для открытия модального окна -->
                                                <button type="button" class="btn btn-primary" data-toggle="modal"   th:attr="data-target='#editUserModal_' + ${user.id}">
                                                    Edit
                                                </button>

                                                <div class="modal fade" th:id="'editUserModal_' + ${user.id}" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form th:action="@{/admin/edit(id=${user.id})}" method="post">
                                                                    <div class="form-group">
                                                                        <label for="id">ID</label>
                                                                        <input type="text" class="form-control" id="id" name="id" th:value="${user.id}" readonly>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="name">First Name</label>
                                                                        <input type="text" class="form-control" id="name" name="name" th:value="${user.name}">
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="lastName">Last Name</label>
                                                                        <input type="text" class="form-control" id="lastName" name="lastName" th:value="${user.lastName}">
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="age">Age</label>
                                                                        <input type="text" class="form-control" id="age" name="age" th:value="${user.age}">
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="username">Email</label>
                                                                        <input type="email" class="form-control" id="username" name="username" th:value="${user.username}">
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="password">Password</label>
                                                                        <input type="password" class="form-control" id="password" name="password">
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="role">Role</label>
                                                                        <select multiple class="form-control" size="2" name="roles[]" th:value="${user.roles}" id="role">
                                                                            <option value="ROLE_ADMIN">ADMIN</option>
                                                                            <option value="ROLE_USER">USER</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                        <button type="submit" class="btn btn-primary">Edit</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </td>
                                            <td>
                                                <form  th:method="DELETE" th:action="@{/admin/delete(id=${user.getId()})}">
                                                    <button type="submit" class="btn btn-danger">Delete</button>
                                                </form>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="tab-pane fade" id="newUser">
                        <div class="card-header font-weight-bold"> Add User </div>
                        <div class="container w-25">
                            <form class="form-group text-center" name="user" style="padding-top: 2em" th:method="POST" th:action="@{admin/}" th:object="${newUser}">
                                <label for="add1">Name</label>
                                <input class="form-control" id="add1" placeholder="name" type="text" th:field="*{name}">
                                <br>
                                <label for="add2">Email</label>
                                <input class="form-control" id="add2" placeholder="lastName" type="text" th:field="*{lastName}" required>
                                <br>
                                <label for="add3">Age</label>
                                <input class="form-control" id="add3" name="age" placeholder="age" type="number" min="0" th:field="*{age}" required>
                                <br>
                                <label for="add4">Username</label>
                                <input class="form-control" id="add4" name="password" placeholder="Email" type="text" th:field="*{username}" required>
                                <br>
                                <label for="add5">Password</label>
                                <input class="form-control" id="add5" name="password" placeholder="Password" type="password" th:field="*{password}" required>
                                <br>
                                <label for="add6">Role</label>
                                <select multiple class="form-control" size="2" name="roles[]" th:field="*{roles}" id="add6">
                                    <option value="ROLE_ADMIN">ADMIN</option>
                                    <option value="ROLE_USER">USER</option>
                                </select>
                                <button class="btn btn-primary" type="submit">Add User</button>
                            </form>
                        </div>
                    </div>

                </div>

            <br>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
        <script>
            // #product a – селектор, выбирающий элементы a, представляющие собой вкладки (при клике на которые нужно отображать соответствующий блок)
            $('#cards a').click(function(e) {
                e.preventDefault();
                $(this).tab('show');
            });
        </script>
    </section>
</div>

</body>

</html>
